# 文件监控到剪贴板脚本

一个PowerShell脚本，用于监控指定文件并在文件有内容时自动将内容复制到剪贴板。

## 功能

- 监控指定文件的变化
- 当文件有内容且内容发生变化时，自动将内容复制到剪贴板
- 显示详细的操作日志（带时间戳）
- 支持自定义检查间隔
- 错误处理机制
- 按 Ctrl+C 可停止监控

## 用法

### 基本语法

```powershell
monitor-file-to-clipboard.ps1 -FilePath "D:\path\to\your\file.txt" [-CheckInterval 1000]
```

### 参数说明

| 参数名 | 类型 | 必需 | 描述 | 默认值 |
|--------|------|------|------|--------|
| `-FilePath` | string | 是 | 要监控的文件路径 | - |
| `-CheckInterval` | int | 否 | 检查文件变化的间隔时间（毫秒） | 1000 |

### 使用示例

#### 示例 1：基本使用

```powershell
.monitor-file-to-clipboard.ps1 -FilePath "D:\test\output.txt"
```

- 监控 `D:\test\output.txt` 文件
- 默认每秒检查一次文件变化

#### 示例 2：自定义检查间隔

```powershell
.monitor-file-to-clipboard.ps1 -FilePath "D:\test\output.txt" -CheckInterval 500
```

- 监控 `D:\test\output.txt` 文件
- 每500毫秒（0.5秒）检查一次文件变化

#### 示例 3：使用相对路径

```powershell
.monitor-file-to-clipboard.ps1 -FilePath ".\logs\app.log" -CheckInterval 2000
```

- 监控当前目录下 `logs\app.log` 文件
- 每2秒检查一次文件变化

## 输出示例

```
监控文件: .\test-monitor.txt
检查间隔: 500 ms
按 Ctrl+C 停止监控...

[2025-12-20 15:00:09] 文件有新内容，复制到剪贴板...
内容已复制到剪贴板
[2025-12-20 15:00:15] 文件有新内容，复制到剪贴板...
内容已复制到剪贴板
```

## 注意事项

1. **执行权限**：确保PowerShell允许执行脚本。如果遇到执行权限问题，可以使用以下命令临时绕过执行策略：
   ```powershell
   powershell.exe -ExecutionPolicy Bypass -File .\monitor-file-to-clipboard.ps1 -FilePath "your-file-path"
   ```

2. **文件路径**：
   - 支持绝对路径和相对路径
   - 路径中包含空格时需要使用引号包围

3. **停止脚本**：
   - 按 `Ctrl+C` 可以停止脚本运行
   - 脚本会立即停止，不会影响系统剪贴板

4. **文件大小**：
   - 只有文件大小大于0时才会复制内容
   - 只有文件大小发生变化时才会复制内容（避免重复复制）

5. **错误处理**：
   - 脚本会捕获并显示错误信息
   - 文件不存在时会显示提示信息

## 系统要求

- Windows操作系统
- PowerShell 5.1 或更高版本
- .NET Framework 4.5 或更高版本（用于 `Set-Clipboard` 命令）

## 应用场景

1. **日志监控**：监控日志文件，实时获取最新日志内容
2. **命令输出监控**：监控命令行工具的输出文件，实时获取结果
3. **文本编辑器协作**：监控共享文本文件，实时获取他人的修改
4. **自动化工作流**：配合其他工具，实现自动化数据传递
5. **调试辅助**：监控调试输出文件，方便复制调试信息

## 使用 Set-Content 测试脚本

您可以使用 PowerShell 的 `Set-Content` 命令来创建或修改文件内容，以测试监控脚本的功能。

### Set-Content 命令简介

`Set-Content` 命令用于将内容写入文件，会覆盖现有文件内容。

### 基本语法

```powershell
Set-Content -Path <文件路径> -Value <内容> [-Encoding <编码>]
```

### 与监控脚本结合使用示例

#### 示例 1：创建或覆盖文件内容

```powershell
# 创建或覆盖文件内容，触发监控脚本复制到剪贴板
Set-Content -Path "D:\test\output.txt" -Value "hello everyone"
```

#### 示例 2：写入多行内容

```powershell
# 写入多行内容到监控文件
Set-Content -Path "D:\test\output.txt" -Value @(
    "第一行内容",
    "第二行内容",
    "第三行内容"
)
```

#### 示例 3：使用变量写入内容

```powershell
# 使用变量存储内容，然后写入文件
$content = "这是通过变量写入的内容"
Set-Content -Path "D:\test\output.txt" -Value $content
```

#### 示例 4：结合其他命令输出

```powershell
# 将命令输出写入监控文件
Get-Date | Set-Content -Path "D:\test\output.txt"
```

### 注意事项

- `Set-Content` 命令会**覆盖**现有文件内容
- 如果文件不存在，`Set-Content` 会自动创建文件
- 支持写入单行或多行内容
- 可以结合管道操作符使用，处理其他命令的输出

通过使用 `Set-Content` 命令，您可以方便地测试监控脚本的功能，验证脚本是否能正确检测到文件变化并将内容复制到剪贴板。

## 使用 Set-Content 写入 Java 代码

您可以使用 PowerShell 的 `Set-Content` 命令来创建和写入 Java 代码文件。以下是几种常用的方法：

### 1. 写入单行 Java 代码

对于简单的单行 Java 代码，可以直接使用 `-Value` 参数写入：

```powershell
# 写入单行 Java 代码
Set-Content -Path "Test.java" -Value "public class Test {}"
```

### 2. 写入多行 Java 代码

对于多行 Java 代码，可以使用数组来存储多行内容：

```powershell
# 写入多行 Java 代码
Set-Content -Path "Test.java" -Value @(
    "public class Test {",
    "    public static void main(String[] args) {",
    "        System.out.println(\"Hello, World!\");",
    "    }",
    "}"
)
```

### 3. 使用 Here-String 写入完整 Java 类

Here-String 是一种方便的方式来写入包含多行文本的内容，特别适合写入完整的 Java 类：

```powershell
# 使用 Here-String 写入完整 Java 类
$javaCode = @"
public class Test {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}
"@

Set-Content -Path "Test.java" -Value $javaCode
```

### 4. 写入带有包声明和导入语句的 Java 代码

```powershell
# 写入带有包声明和导入语句的 Java 代码
$javaCode = @"
package com.example;

import java.util.ArrayList;
import java.util.List;

public class Test {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("Item 1");
        list.add("Item 2");
        
        for (String item : list) {
            System.out.println(item);
        }
    }
}
"@

Set-Content -Path "Test.java" -Value $javaCode
```

### 5. 使用编码参数确保正确的字符编码

Java 文件通常使用 UTF-8 编码，您可以使用 `-Encoding` 参数指定：

```powershell
# 使用 UTF-8 编码写入 Java 代码
Set-Content -Path "Test.java" -Value $javaCode -Encoding UTF8
```

### 6. 结合其他命令生成并写入 Java 代码

```powershell
# 结合其他命令生成 Java 代码并写入文件
$currentDate = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
$javaCode = @"
public class Test {
    public static void main(String[] args) {
        System.out.println("Generated on: $currentDate");
    }
}
"@

Set-Content -Path "Test.java" -Value $javaCode
```

### 7. 示例：创建一个完整的 Java 类文件

```powershell
# 创建一个完整的 Java 类文件
$javaClass = @"
/**
 * 测试类，用于演示 Set-Content 命令
 * @author Generated by PowerShell
 */
public class TestClass {
    
    // 成员变量
    private String name;
    private int age;
    
    // 构造方法
    public TestClass(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    // getter 和 setter 方法
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
    
    public int getAge() {
        return age;
    }
    
    public void setAge(int age) {
        this.age = age;
    }
    
    // toString 方法
    @Override
    public String toString() {
        return "TestClass{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }
    
    // 主方法
    public static void main(String[] args) {
        TestClass test = new TestClass("Test", 25);
        System.out.println(test);
    }
}
"@

# 写入文件，使用 UTF-8 编码
Set-Content -Path "TestClass.java" -Value $javaClass -Encoding UTF8
```

### 注意事项

1. **文件名与类名匹配**：Java 文件名应该与公共类名完全匹配
2. **文件扩展名**：Java 文件必须使用 `.java` 扩展名
3. **编码**：建议使用 UTF-8 编码，特别是当代码中包含非 ASCII 字符时
4. **特殊字符**：在字符串中使用引号时，需要使用转义字符 `\`
5. **缩进**：保持良好的缩进，使代码更易读
6. **包声明**：如果使用包声明，需要确保文件位于正确的目录结构中

通过这些方法，您可以方便地使用 PowerShell 的 `Set-Content` 命令来创建和写入 Java 代码文件，结合监控脚本可以实时监控这些文件的变化。

## 安装

1. 下载 `monitor-file-to-clipboard.ps1` 脚本文件
2. 将脚本文件保存到任意目录
3. 按照上述用法运行脚本

## 许可证

本脚本采用 MIT 许可证，您可以自由使用、修改和分发。

## 作者

由 AI 助手创建

## 更新日志

### v1.0 (2025-12-20)
- 初始版本
- 实现基本的文件监控功能
- 支持自动复制内容到剪贴板
- 显示详细的操作日志
- 支持自定义检查间隔
- 包含错误处理机制